<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Ubike æœ€è¿‘ç«™é»</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h2>ğŸš² Ubikeï¼ˆé«˜é›„ï¼‰</h2>

  <button onclick="find('rent')">ğŸš² æ‰¾å¯å€Ÿè»Š</button>
  <button onclick="find('return')">ğŸ…¿ï¸ æ‰¾å¯é‚„è»Š</button>

  <pre id="out">è«‹é»ä¸Šæ–¹æŒ‰éˆ•</pre>

  <script>
    
<script>
const API_BASE = "https://ubike-proxy.onrender.com";

function log(msg) {
  document.getElementById('out').textContent = msg;
}

async function find(mode) {
  try {
    log('ğŸ“ å®šä½ä¸­â€¦');

    const pos = await new Promise((ok, err) =>
      navigator.geolocation.getCurrentPosition(ok, err)
    );

    log('ğŸŒ å‘¼å« /bike/station â€¦');
    const r1 = await fetch(API_BASE + '/bike/station');
    log('ğŸŒ station status = ' + r1.status);
    const stations = await r1.json();

    log('ğŸŒ å‘¼å« /bike/availability â€¦');
    const r2 = await fetch(API_BASE + '/bike/availability');
    log('ğŸŒ availability status = ' + r2.status);
    const availability = await r2.json();

    log(`âœ… æˆåŠŸï¼š${stations.length} / ${availability.length}`);

  } catch (e) {
    log(
      'âŒ éŒ¯èª¤åç¨±ï¼š' + e.name + '\n' +
      'âŒ éŒ¯èª¤è¨Šæ¯ï¼š' + e.message
    );
  }
}
</script>
