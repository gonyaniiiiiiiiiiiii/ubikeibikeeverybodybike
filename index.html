<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Ubike æœ€è¿‘ç«™é»</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h2>ğŸš² Ubikeï¼ˆé«˜é›„ï¼‰</h2>

  <button onclick="find('rent')">ğŸš² æ‰¾å¯å€Ÿè»Š</button>
  <button onclick="find('return')">ğŸ…¿ï¸ æ‰¾å¯é‚„è»Š</button>

  <pre id="out">è«‹é»ä¸Šæ–¹æŒ‰éˆ•</pre>

  <script>
    
const API_BASE = "https://ubike-proxy.onrender.com"; // å†ç¢ºèªä¸€æ¬¡

function log(msg) {
  document.getElementById('out').textContent = msg;
}

async function find(mode) {
  try {
    log('ğŸ“ å®šä½ä¸­â€¦');

    const pos = await new Promise((ok, err) =>
      navigator.geolocation.getCurrentPosition(ok, err)
    );

    log('ğŸŒ é€£ç·šå¾Œç«¯ä¸­ï¼ˆstationï¼‰â€¦');
    const stationRes = await fetch(API_BASE + '/bike/station');
    log('ğŸŒ station å›æ‡‰ä¸­â€¦');
    const stations = await stationRes.json();

    log('ğŸŒ é€£ç·šå¾Œç«¯ä¸­ï¼ˆavailabilityï¼‰â€¦');
    const availRes = await fetch(API_BASE + '/bike/availability');
    log('ğŸŒ availability å›æ‡‰ä¸­â€¦');
    const availability = await availRes.json();

    log(`âœ… å–å¾— ${stations.length} ç«™é» / ${availability.length} ç‹€æ…‹`);

  } catch (e) {
    log('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š\n' + e.message);
  }
}
</script>

</body>
</html>
